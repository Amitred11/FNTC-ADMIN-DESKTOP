<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Orders Management</title>
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/regular/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/fill/style.css">
    <link rel="stylesheet" href="../../styles/components/alert-component-styles.css">
    <link rel="stylesheet" href="../../styles/main/joborder.css">
    <link rel="stylesheet" href="../../styles/components/sidebar.css">
    <link rel="stylesheet" href="../../styles/components/header.css">
</head>
<body data-page="joborder">
    <div class="layout" id="layout">
        <div id="sidebar-container"></div>
        <div class="sidebar-mobile-overlay" id="sidebar-overlay"></div>

        <!-- MAIN SECTION -->
        <main class="main-section">
            <div id="header-container"></div>

            <!-- Job Orders Content -->
            <section class="joborders-section" aria-labelledby="joborders-title">

                <!-- CARD ROW -->
                <section class="cards-row" role="list" aria-label="Job summary cards">
                    <article class="summary-card" role="listitem" data-key="active">
                        <div class="card-inner">
                            <div class="card-title">Total Active</div>
                            <div class="card-value">0</div>
                        </div>
                    </article>
                    <article class="summary-card" role="listitem" data-key="pending">
                        <div class="card-inner">
                            <div class="card-title">Pending Assignment</div>
                            <div class="card-value">0</div>
                        </div>
                    </article>
                    <article class="summary-card" role="listitem" data-key="completed">
                        <div class="card-inner">
                            <div class="card-title">Total Completed</div>
                            <div class="card-value">0</div>
                        </div>
                    </article>
                    <article class="summary-card" role="listitem" data-key="overdue">
                        <div class="card-inner">
                            <div class="card-title">Over Due</div>
                            <div class="card-value">0</div>
                        </div>
                    </article>
                </section>

                <!-- SEARCH / FILTER / ACTIONS ROW -->
                <section class="controls-row">
                    <div class="search-filter">
                        <label class="sr-only" for="job-search">Search</label>
                        <input id="job-search" class="search-input" type="search" placeholder="Search..." />
                        <label class="sr-only" for="job-filter">Filter</label>
                        <select id="job-filter" class="filter-select">
                            <option>All Types</option>
                            <option>Installation</option>
                            <option>Repair</option>
                            <option>Maintenance</option>
                            <option>Upgrade</option>
                            <option>Downgrade</option>
                            <option>Disconnection</option>
                        </select>
                    </div>
                    <div class="actions-right">
                        <button id="archiveBtn" class="btn ghost" type="button">
                            <i class="ph ph-archive-box"></i> Archive
                        </button>
                        <button id="createOrderBtn" class="btn primary" type="button">
                            <i class="ph ph-plus"></i> Create New Order
                        </button>
                    </div>
                </section>

                <!-- JOBS TABLE -->
                <section class="table-wrap" aria-label="Job orders table">
                    <table class="jobs-table" aria-describedby="jobs-desc">
                        <caption id="jobs-desc" class="sr-only">List of job orders with status and assigned technicians</caption>
                        <thead>
                            <tr>
                                <th>Job ID</th>
                                <th>Customer</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Assigned Tech</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be dynamically inserted here by joborder.js -->
                        </tbody>
                    </table>
                </section>
            </section>
        </main>
    </div>

    <!-- ARCHIVE DIALOG -->
    <dialog id="archiveDialog" class="dialog">
        <div class="dialog-inner">
            <header class="dialog-header">
                <h3>Archived Job Orders</h3>
                <button class="close" type="button" onclick="this.closest('dialog').close()"><i class="ph ph-x"></i></button>
            </header>
            <section class="dialog-body">
                <p>List of previously completed and archived jobs. Archived jobs can be permanently deleted.</p>
                <ul class="archive-list" id="archive-list-container">
                    <!-- Archived jobs will be loaded here -->
                </ul>
            </section>
            <footer class="dialog-actions">
                <button class="btn ghost" type="button" onclick="this.closest('dialog').close()">Close</button>
            </footer>
        </div>
    </dialog>

    <!-- CREATE ORDER DIALOG -->
    <dialog id="createOrderDialog" class="dialog">
        <form class="dialog-inner" id="createOrderForm">
            <header class="dialog-header">
                <h3>Create New Order</h3>
                <button class="close" type="button" onclick="this.closest('dialog').close()"><i class="ph ph-x"></i></button>
            </header>
            <section class="dialog-body form-grid">
                <label class="full">
                    Type
                    <select name="type" required>
                        <option value="" disabled selected>Select job type...</option>
                        <option value="Installation">Installation</option>
                        <option value="Repair">Repair</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Upgrade">Upgrade</option>
                        <option value="Downgrade">Downgrade</option>
                        <option value="Disconnection">Disconnection</option>
                    </select>
                </label>

                <!-- Customer Selection -->
                <fieldset class="full customer-fieldset">
                    <legend>Customer</legend>
                    <div class="customer-type-toggle">
                        <label><input type="radio" name="customerType" value="subscriber" checked>Subscriber</label>
                        <label><input type="radio" name="customerType" value="walk-in">Walk-in</label>
                    </div>
                    <div id="subscriber-select-container">
                        <label for="subscriber-select" class="sr-only">Select Subscriber</label>
                        <select name="userId" id="subscriber-select">
                            <!-- Subscriber options loaded by JS -->
                        </select>
                    </div>
                    <div id="walk-in-container" class="form-grid" style="display: none;">
                        <label class="full">
                            Customer Name
                            <input type="text" name="customerName" placeholder="e.g. John Doe">
                        </label>
                        <label>
                            Phone Number (Optional)
                            <input type="tel" name="customerPhone" placeholder="e.g. 555-1234">
                        </label>
                        <label>
                            Email (Optional)
                            <input type="email" name="customerEmail" placeholder="e.g. john.doe@example.com">
                        </label>
                    </div>
                </fieldset>

                <label class="full">
                    Job Description
                    <textarea name="description" rows="3" required placeholder="Describe the issue or task..."></textarea>
                </label>
                <fieldset class="assign-fieldset">
                    <legend>Assign Technician</legend>
                    <div class="toggle-row">
                        <label class="switch">
                            <input type="checkbox" id="autoAssignCreate">
                            <span class="slider"></span>
                        </label>
                        <span class="toggle-label">Auto Assign Technician</span>
                    </div>
                    <label class="full" id="manual-assign-container">
                        Manual Select Technician
                        <select name="agentId" id="manualTechCreate">
                            <!-- Technician options will be loaded here -->
                        </select>
                    </label>
                </fieldset>
            </section>
            <footer class="dialog-actions">
                 <button class="btn ghost" type="button" onclick="this.closest('dialog').close()">Cancel</button>
                <button class="btn primary" type="submit">Create</button>
            </footer>
        </form>
    </dialog>

    <!-- VIEW DETAILS DIALOG (CORRECTED) -->
    <dialog id="viewDetailDialog" class="dialog wide">
        <article class="dialog-inner">
            <header class="dialog-header">
                <div class="header-left">
                    <h3>Job Details</h3>
                    <strong id="modal-header-job-id"></strong>
                    <div id="modal-header-status"></div>
                </div>
                <button class="close" type="button" onclick="this.closest('dialog').close()"><i class="ph ph-x"></i></button>
            </header>

            <section class="dialog-body">
                <div class="details-grid-container">
                    <!-- Job & Customer Info Section -->
                    <div class="info-section">
                        <div class="info-column">
                            <h4 class="details-subtitle">Job Information</h4>
                            <p><strong>Type:</strong> <span id="detail-type">--</span></p>
                            <p><strong>Created:</strong> <span id="detail-created">--</span></p>
                            <h4 class="details-subtitle" style="margin-top: 1rem;">Description</h4>
                            <p id="detail-description" class="description-box">--</p>
                        </div>
                        <div class="info-column">
                            <h4 class="details-subtitle">Customer Details</h4>
                            <p><strong>Name:</strong> <span id="detail-customer-name">--</span></p>
                            <p><strong>Contact:</strong> <span id="detail-contact">--</span></p>
                            <p><strong>Address:</strong> <span id="detail-address">--</span></p>
                        </div>
                    </div>
                    
                    <!-- Notes & History Section -->
                    <div class="notes-section">
                        <h4 class="details-subtitle">History &amp; Notes</h4>
                        <div id="detail-notes-container">
                            <!-- Notes and evidence will be rendered here by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <footer class="dialog-actions">
                <button class="btn ghost" type="button" onclick="this.closest('dialog').close()">Close</button>
            </footer>
        </article>
    </dialog>

    <!-- ASSIGN TECHNICIAN DIALOG -->
    <dialog id="assignDialog" class="dialog">
        <form class="dialog-inner" id="assignForm">
            <header class="dialog-header">
                <h3>Assign Technician</h3>
                <button class="close" type="button" onclick="this.closest('dialog').close()"><i class="ph ph-x"></i></button>
            </header>
            <section class="dialog-body">
                <p>Assign a technician to Job ID: <strong id="assign-job-id"></strong></p>
                <br>
                <label>
                    Select Available Technician
                    <select id="manualTechAssign" name="agentId" required>
                        <!-- Technician options will be loaded here -->
                    </select>
                </label>
            </section>
            <footer class="dialog-actions">
                 <button class="btn ghost" type="reset" onclick="this.closest('dialog').close()">Cancel</button>
                <button class="btn primary" type="submit">Save Changes</button>
            </footer>
        </form>
    </dialog>

    <!-- LIGHTBOX FOR IMAGE EVIDENCE -->
    <dialog id="imageLightbox" class="lightbox-overlay">
        <span class="lightbox-close" title="Close">&times;</span>
        <img class="lightbox-content" id="lightboxImg" alt="Evidence enlarged">
    </dialog>

   <!-- APP ALERT COMPONENT HTML -->
    <div id="app-alert-container">
        <div id="app-alert-overlay" class="app-alert-overlay"></div>
    
        <div id="app-alert-box" class="app-alert-box" role="alertdialog" aria-modal="true" aria-labelledby="app-alert-title" aria-describedby="app-alert-message">
            <div class="app-alert-icon-wrapper">
                <i id="app-alert-icon" class="ph-fill"></i>
            </div>
            <h2 id="app-alert-title" class="app-alert-title"></h2>
            <p id="app-alert-message" class="app-alert-message"></p>
            <div class="app-alert-buttons">
                <button id="app-alert-cancel-btn" class="app-alert-button cancel"></button>
                <button id="app-alert-confirm-btn" class="app-alert-button confirm"></button>
            </div>
        </div>
        
        <!-- DIALOG-based Modal for appearing over other modals -->
        <dialog id="app-alert-dialog-box" class="app-alert-dialog" aria-labelledby="app-alert-dialog-title" aria-describedby="app-alert-dialog-message">
            <div class="app-alert-icon-wrapper">
                <i id="app-alert-dialog-icon" class="ph-fill"></i>
            </div>
            <h2 id="app-alert-dialog-title" class="app-alert-title"></h2>
            <p id="app-alert-dialog-message" class="app-alert-message"></p>
            <div class="app-alert-buttons">
                <button id="app-alert-dialog-cancel-btn" class="app-alert-button cancel"></button>
                <button id="app-alert-dialog-confirm-btn" class="app-alert-button confirm"></button>
            </div>
        </dialog>
    
        <!-- Container for Toast Notifications -->
        <div id="app-alert-toast-container" aria-live="assertive" aria-atomic="true"></div>
    </div>
    <script src="../../scripts/components/app-alert.js"></script>
    <script src="../../scripts/main/joborder.js"></script>
    <script src="../../scripts/components/sidebar.js"></script>
    <script src="../../scripts/components/header.js"></script>
</body>
</html>